<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Ratings Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .star-rating {
            display: inline-flex;
            align-items: center;
            gap: 2px;
        }
        .star-filled {
            color: #FCD34D;
        }
        .star-empty {
            color: #D1D5DB;
        }
        .progress-bar {
            background: linear-gradient(90deg, #F59E0B 0%, #F59E0B var(--progress), #E5E7EB var(--progress), #E5E7EB 100%);
            border-radius: 4px;
            height: 8px;
        }
        .vendor-card:hover {
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .badge-green {
            background-color: #D1FAE5;
            color: #059669;
        }
        .badge-yellow {
            background-color: #FEF3C7;
            color: #D97706;
        }
        .badge-red {
            background-color: #FEE2E2;
            color: #DC2626;
        }
        .badge-blue {
            background-color: #DBEAFE;
            color: #2563EB;
        }
        .risk-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .risk-low { background-color: #10B981; }
        .risk-medium { background-color: #F59E0B; }
        .risk-high { background-color: #EF4444; }
        .payment-status {
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 11px;
        }
        .status-excellent { background-color: #D1FAE5; color: #065F46; }
        .status-good { background-color: #FEF3C7; color: #92400E; }
        .status-warning { background-color: #FEE2E2; color: #991B1B; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h1 class="text-2xl font-bold text-gray-900">Vendor Performance Dashboard</h1>
                <a href="/dashboard" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-sm flex items-center">
                    ⇽   Dashboard 
                </a>
            </div>
            
            <!-- Filters -->
            <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center space-x-2">
                    <i data-lucide="filter" class="h-4 w-4 text-gray-500"></i>
                    <span class="text-sm font-medium text-gray-700">Filters:</span>
                </div>
                
                <select id="businessTypeFilter" class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    <option value="all">All Business Types</option>
                    <option value="street-food">Street Food Stalls</option>
                    <option value="restaurants">Small Restaurants</option>
                    <option value="food-trucks">Food Trucks</option>
                    <option value="catering">Catering Services</option>
                </select>

                <select id="paymentRatingFilter" class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    <option value="all">All Payment Ratings</option>
                    <option value="excellent">Excellent (4.5+)</option>
                    <option value="good">Good (3.5-4.4)</option>
                    <option value="fair">Fair (2.5-3.4)</option>
                    <option value="poor">Poor (<2.5)</option>
                </select>

                <select id="riskLevelFilter" class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    <option value="all">All Risk Levels</option>
                    <option value="low">Low Risk</option>
                    <option value="medium">Medium Risk</option>
                    <option value="high">High Risk</option>
                </select>

                <select id="locationFilter" class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    <option value="all">All Locations</option>
                    <option value="mumbai">Mumbai</option>
                    <option value="delhi">Delhi</option>
                    <option value="bangalore">Bangalore</option>
                    <option value="pune">Pune</option>
                </select>

                <select id="sortBy" class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    <option value="overall">Sort by Overall Rating</option>
                    <option value="payment">Sort by Payment Score</option>
                    <option value="volume">Sort by Order Volume</option>
                    <option value="reliability">Sort by Reliability</option>
                </select>
            </div>
        </div>

        <!-- Overall Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Active Vendors</p>
                        <p id="totalVendors" class="text-2xl font-bold text-gray-900">89</p>
                        <p class="text-sm text-green-600 flex items-center mt-1">
                            <i data-lucide="trending-up" class="h-4 w-4 mr-1"></i>
                            <span id="vendorGrowth">+7 this month</span>
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="store" class="h-6 w-6 text-blue-600"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Avg Payment Score</p>
                        <p id="avgPaymentScore" class="text-2xl font-bold text-gray-900">4.1/5</p>
                        <p class="text-sm text-green-600 flex items-center mt-1">
                            <i data-lucide="trending-up" class="h-4 w-4 mr-1"></i>
                            <span id="paymentTrend">+0.2 this quarter</span>
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="credit-card" class="h-6 w-6 text-green-600"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Monthly Volume</p>
                        <p id="monthlyVolume" class="text-2xl font-bold text-gray-900">₹12.5L</p>
                        <p class="text-sm text-blue-600 flex items-center mt-1">
                            <i data-lucide="trending-up" class="h-4 w-4 mr-1"></i>
                            <span id="volumeGrowth">+15% from last month</span>
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="indian-rupee" class="h-6 w-6 text-purple-600"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">High Risk Vendors</p>
                        <p id="highRiskCount" class="text-2xl font-bold text-gray-900">8</p>
                        <p class="text-sm text-red-600 flex items-center mt-1">
                            <i data-lucide="alert-triangle" class="h-4 w-4 mr-1"></i>
                            <span id="riskPercent">9% of total</span>
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-red-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="alert-triangle" class="h-6 w-6 text-red-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Payment Score Distribution</h3>
                <div id="paymentDistribution" class="space-y-3">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium">Excellent (4.5-5.0)</span>
                            <span class="status-excellent payment-status">RELIABLE</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="progress-bar w-24" style="--progress: 35%"></div>
                            <span class="text-sm text-gray-600 w-8">31</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium">Good (3.5-4.4)</span>
                            <span class="status-good payment-status">STABLE</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="progress-bar w-24" style="--progress: 40%"></div>
                            <span class="text-sm text-gray-600 w-8">36</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium">Fair (2.5-3.4)</span>
                            <span class="status-good payment-status">MONITOR</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="progress-bar w-24" style="--progress: 18%"></div>
                            <span class="text-sm text-gray-600 w-8">16</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium">Poor (<2.5)</span>
                            <span class="status-warning payment-status">CAUTION</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="progress-bar w-24" style="--progress: 7%"></div>
                            <span class="text-sm text-gray-600 w-8">6</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Business Type Performance</h3>
                <div id="businessTypePerformance" class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="utensils" class="h-4 w-4 text-orange-600"></i>
                            </div>
                            <span class="font-medium">Street Food Stalls</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="star-rating">
                                <span class="text-sm font-bold">4.2</span>
                                <i data-lucide="star" class="h-4 w-4 star-filled ml-1"></i>
                            </div>
                            <span class="text-sm text-gray-600">42 vendors</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="chef-hat" class="h-4 w-4 text-red-600"></i>
                            </div>
                            <span class="font-medium">Small Restaurants</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="star-rating">
                                <span class="text-sm font-bold">4.0</span>
                                <i data-lucide="star" class="h-4 w-4 star-filled ml-1"></i>
                            </div>
                            <span class="text-sm text-gray-600">23 vendors</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="truck" class="h-4 w-4 text-blue-600"></i>
                            </div>
                            <span class="font-medium">Food Trucks</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="star-rating">
                                <span class="text-sm font-bold">3.8</span>
                                <i data-lucide="star" class="h-4 w-4 star-filled ml-1"></i>
                            </div>
                            <span class="text-sm text-gray-600">15 vendors</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="calendar" class="h-4 w-4 text-green-600"></i>
                            </div>
                            <span class="font-medium">Catering Services</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="star-rating">
                                <span class="text-sm font-bold">4.4</span>
                                <i data-lucide="star" class="h-4 w-4 star-filled ml-1"></i>
                            </div>
                            <span class="text-sm text-gray-600">9 vendors</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vendor List -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-6">Vendor Directory</h3>
            <div id="vendorList" class="space-y-6">
                
                <!-- Vendor 1 -->
                <div class="vendor-card border border-gray-200 rounded-lg p-6" data-vendor-id="VEN001">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-start space-x-4">
                            <div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-orange-600 rounded-lg flex items-center justify-center text-white font-bold text-xl">
                                R
                            </div>
                            <div>
                                <div class="flex items-center space-x-2 mb-1">
                                    <h4 class="text-lg font-semibold text-gray-900" id="vendor1-name">Raj's Mumbai Chaat</h4>
                                    <div class="risk-indicator risk-low" title="Low Risk"></div>
                                    <span class="badge-green badge">VERIFIED</span>
                                </div>
                                <div class="flex items-center space-x-4 text-sm text-gray-600 mb-2">
                                    <span class="flex items-center">
                                        <i data-lucide="map-pin" class="h-4 w-4 mr-1"></i>
                                        <span id="vendor1-location">Bandra West, Mumbai</span>
                                    </span>
                                    <span class="flex items-center">
                                        <i data-lucide="store" class="h-4 w-4 mr-1"></i>
                                        <span id="vendor1-type">Street Food Stall</span>
                                    </span>
                                    <span class="flex items-center">
                                        <i data-lucide="calendar" class="h-4 w-4 mr-1"></i>
                                        Partner since <span id="vendor1-since">2020</span>
                                    </span>
                                </div>
                                <div class="flex flex-wrap gap-2 mb-3" id="vendor1-specialties">
                                    <span class="badge badge-blue">Regular Orders</span>
                                    <span class="badge badge-green">Timely Payments</span>
                                    <span class="badge badge-blue">Good Communication</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center mb-2">
                                <div class="star-rating">
                                    <i data-lucide="star" class="h-4 w-4 star-filled"></i>
                                    <i data-lucide="star" class="h-4 w-4 star-filled"></i>
                                    <i data-lucide="star" class="h-4 w-4 star-filled"></i>
                                    <i data-lucide="star" class="h-4 w-4 star-filled"></i>
                                    <i data-lucide="star" class="h-4 w-4 star-filled"></i>
                                </div>
                                <span class="ml-2 text-sm font-medium text-gray-900" id="vendor1-rating">4.8</span>
                            </div>
                            <div class="text-sm text-gray-600">Overall Rating</div>
                            <div class="text-lg font-semibold text-gray-900 mt-1">₹<span id="vendor1-monthly">45,000</span>/month</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-4 mb-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600" id="vendor1-payment">4.9</div>
                            <div class="text-xs text-gray-600">Payment Score</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600" id="vendor1-reliability">4.7</div>
                            <div class="text-xs text-gray-600">Reliability</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-600" id="vendor1-communication">4.8</div>
                            <div class="text-xs text-gray-600">Communication</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-orange-600" id="vendor1-volume">4.6</div>
                            <div class="text-xs text-gray-600">Order Volume</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600 mb-4">
                        <div class="flex items-center">
                            <i data-lucide="clock" class="h-4 w-4 mr-2"></i>
                            Avg Payment: <span id="vendor1-paymentdays" class="ml-1 font-medium">2 days</span>
                        </div>
                        <div class="flex items-center">
                            <i data-lucide="repeat" class="h-4 w-4 mr-2"></i>
                            Orders: <span id="vendor1-orders" class="ml-1 font-medium">156/month</span>
                        </div>
                        <div class="flex items-center">
                            <i data-lucide="phone" class="h-4 w-4 mr-2"></i>
                            <span id="vendor1-contact">+91 98765 43210</span>
                        </div>
                        <div class="flex items-center">
                            <i data-lucide="percent" class="h-4 w-4 mr-2"></i>
                            Credit Limit: <span id="vendor1-credit" class="ml-1 font-medium">₹25,000</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                        <div class="flex space-x-2">
                            <button class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-sm">
                                View Details
                            </button>
                            <button class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                                Transaction History
                            </button>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-4 py-2 border border-orange-600 text-orange-600 rounded-lg hover:bg-orange-50 transition-colors text-sm">
                                Rate Vendor
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Vendor 2 -->
                <div class="vendor-card border border-gray-200 rounded-lg p-6" data-vendor-id="VEN002">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-start space-x-4">
                            <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-lg flex items-center justify-center text-white font-bold text-xl">
                                D
                            </div>
                            <div>
                                <div class="flex items-center space-x-2 mb-1">
                                    <h4 class="text-lg font-semibold text-gray-900" id="vendor2-name">Delhi Street Kitchen</h4>
                                    <div class="risk-indicator risk-medium" title="Medium Risk"></div>
                                    <span class="badge-yellow badge">PENDING</span>
                                </div>
                                <div class="flex items-center space-x-4 text-sm text-gray-600 mb-2">
                                    <span class="flex items-center">
                                        <i data-lucide="map-pin" class="h-4 w-4 mr-1"></i>
                                        <span id="vendor2-location">Connaught Place, Delhi</span>
                                    </span>
                                    <span class="flex items-center">
                                        <i data-lucide="store" class="h-4 w-4 mr-1"></i>
                                        <span id="vendor2-type">Food Truck</span>
                                    </span>
                                    <span class="flex items-center">
                                        <i data-lucide="calendar" class="h-4 w-4 mr-1"></i>
                                        Partner since <span id="vendor2-since">2021</span>
                                    </span>
                                </div>
                                <div class="flex flex-wrap gap-2 mb-3" id="vendor2-specialties">
                                    <span class="badge badge-blue">Growing Orders</span>
                                    <span class="badge badge-yellow">Payment Delays</span>
                                    <span class="badge badge-blue">Responsive</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center mb-2">
                                <div class="star-rating">
                                    <i data-lucide="star" class="h-4 w-4 star-filled"></i>
                                    <i data-lucide="star" class="h-4 w-4 star-filled"></i>
                                    <i data-lucide="star" class="h-4 w-4 star-filled"></i>
                                    <i data-lucide="star" class="h-4 w-4 star-filled"></i>
                                    <i data-lucide="star" class="h-4 w-4 star-empty"></i>
                                </div>
                                <span class="ml-2 text-sm font-medium text-gray-900" id="vendor2-rating">3.8</span>
                            </div>
                            <div class="text-sm text-gray-600">Overall Rating</div>
                            <div class="text-lg font-semibold text-gray-900 mt-1">₹<span id="vendor2-monthly">28,500</span>/month</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-4 mb-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-yellow-600" id="vendor2-payment">3.2</div>
                            <div class="text-xs text-gray-600">Payment Score</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600" id="vendor2-reliability">4.1</div>
                            <div class="text-xs text-gray-600">Reliability</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-600" id="vendor2-communication">4.2</div>
                            <div class="text-xs text-gray-600">Communication</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-orange-600" id="vendor2-volume">3.5</div>
                            <div class="text-xs text-gray-600">Order Volume</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600 mb-4">
                        <div class="flex items-center">
                            <i data-lucide="clock" class="h-4 w-4 mr-2"></i>
                            Avg Payment: <span id="vendor2-paymentdays" class="ml-1 font-medium">7 days</span>
                        </div>
                        <div class="flex items-center">
                            <i data-lucide="repeat" class="h-4 w-4 mr-2"></i>
                            Orders: <span id="vendor2-orders" class="ml-1 font-medium">82/month</span>
                        </div>
                        <div class="flex items-center">
                            <i data-lucide="phone" class="h-4 w-4 mr-2"></i>
                            <span id="vendor2-contact">+91 87654 32109</span>
                        </div>
                        <div class="flex items-center">
                            <i data-lucide="percent" class="h-4 w-4 mr-2"></i>
                            Credit Limit: <span id="vendor2-credit" class="ml-1 font-medium">₹15,000</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                        <div class="flex space-x-2">
                            <button class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-sm">
                                View Details
                            </button>
                            <button class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                                Transaction History
                            </button>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-4 py-2 border border-orange-600 text-orange-600 rounded-lg hover:bg-orange-50 transition-colors text-sm">
                                Rate Vendor
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script>
async function loadVendorSummaryData() {
    try {
        const response = await fetch('/api/vendor-data');
        const data = await response.json();

        // Update Summary Tiles
        document.getElementById('totalVendors').textContent = data.active_vendor;
        document.getElementById('avgPaymentScore').textContent = `${data.avg_payment_score}/5`;
        document.getElementById('monthlyVolume').textContent = `₹${(data.monthly_volume / 100000).toFixed(2)}L`;
        document.getElementById('highRiskCount').textContent = data.highrisk_vendor;
        document.getElementById('riskPercent').textContent = `${((data.highrisk_vendor / data.active_vendor) * 100).toFixed(1)}% of total`;

        // Payment Score Distribution Chart
        const paymentDist = data.paymentscore_distribution;
        const distributionContainer = document.getElementById('paymentDistribution');
        distributionContainer.innerHTML = ''; // clear old

        const buckets = {
            excellent: { label: "Excellent (4.5-5.0)", badge: "RELIABLE", class: "status-excellent" },
            good: { label: "Good (3.5-4.4)", badge: "STABLE", class: "status-good" },
            fair: { label: "Fair (2.5-3.4)", badge: "MONITOR", class: "status-good" },
            poor: { label: "Poor (<2.5)", badge: "CAUTION", class: "status-warning" }
        };

        const totalVendors = Object.values(paymentDist).reduce((a, b) => a + b, 0);

        for (const [key, count] of Object.entries(paymentDist)) {
            const percent = ((count / totalVendors) * 100).toFixed(1);
            const { label, badge, class: badgeClass } = buckets[key];

            distributionContainer.innerHTML += `
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <span class="text-sm font-medium">${label}</span>
                        <span class="${badgeClass} payment-status">${badge}</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="progress-bar w-24" style="--progress: ${percent}%"></div>
                        <span class="text-sm text-gray-600 w-8">${count}</span>
                    </div>
                </div>
            `;
        }

        // Business Type Performance Section
        const typeContainer = document.getElementById('businessTypePerformance');
        typeContainer.innerHTML = ''; // clear old

        const icons = {
            "Street Food Stall": { icon: "utensils", color: "orange" },
            "Small Restaurant": { icon: "chef-hat", color: "red" },
            "Food Truck": { icon: "truck", color: "blue" },
            "Catering Services": { icon: "calendar", color: "green" }
        };

        for (const [type, info] of Object.entries(data.business_type_performance)) {
            const icon = icons[type] || { icon: "store", color: "gray" };

            typeContainer.innerHTML += `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-${icon.color}-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="${icon.icon}" class="h-4 w-4 text-${icon.color}-600"></i>
                        </div>
                        <span class="font-medium">${type}</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="star-rating">
                            <span class="text-sm font-bold">${info.average_score}</span>
                            <i data-lucide="star" class="h-4 w-4 star-filled ml-1"></i>
                        </div>
                        <span class="text-sm text-gray-600">${info.vendor_count} vendors</span>
                    </div>
                </div>
            `;
        }

        lucide.createIcons(); // Refresh all icons after injecting
    } catch (err) {
        console.error('🧨 Error loading vendor summary data:', err);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    loadVendorSummaryData();
});
</script>

    <script>
async function fetchAndRenderVendors() {
    const businessType = document.getElementById('businessTypeFilter').value;
    const paymentRating = document.getElementById('paymentRatingFilter').value;
    const riskLevel = document.getElementById('riskLevelFilter').value;
    const location = document.getElementById('locationFilter').value;
    const sortBy = document.getElementById('sortBy').value;

    const filters = {
        business_type: businessType,
        payment_rating: paymentRating,
        risk_level: riskLevel,
        location: location,
        sort_by: sortBy
    };

    try {
        const res = await fetch('/api/vendor', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(filters)
        });

        const data = await res.json();
        renderVendors(data.vendors);
    } catch (err) {
        console.error('🔥 Vendor fetch error:', err);
    }
}

function renderVendors(vendors) {
    const vendorList = document.getElementById('vendorList');
    vendorList.innerHTML = ''; // Clear old data

    vendors.forEach((vendor, index) => {
        const card = `
        <div class="vendor-card border border-gray-200 rounded-lg p-6" data-vendor-id="${vendor.id}">
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-start space-x-4">
                    <div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-orange-600 rounded-lg flex items-center justify-center text-white font-bold text-xl">
                        ${vendor.name[0]}
                    </div>
                    <div>
                        <div class="flex items-center space-x-2 mb-1">
                            <h4 class="text-lg font-semibold text-gray-900">${vendor.name}</h4>
                            <div class="risk-indicator risk-${vendor.risk_level}"></div>
                            <span class="badge-${vendor.verification_status.toLowerCase() === 'verified' ? 'green' : vendor.verification_status.toLowerCase() === 'pending' ? 'yellow' : 'red'} badge">
                                ${vendor.verification_status.toUpperCase()}
                            </span>
                        </div>
                        <div class="flex items-center space-x-4 text-sm text-gray-600 mb-2">
                            <span class="flex items-center"><i data-lucide="map-pin" class="h-4 w-4 mr-1"></i>${vendor.location}</span>
                            <span class="flex items-center"><i data-lucide="store" class="h-4 w-4 mr-1"></i>${vendor.business_type}</span>
                            <span class="flex items-center"><i data-lucide="calendar" class="h-4 w-4 mr-1"></i>Partner since ${vendor.partner_since}</span>
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="flex items-center mb-2">
                        <div class="star-rating">${renderStars(vendor.overall_rating)}</div>
                        <span class="ml-2 text-sm font-medium text-gray-900">${vendor.overall_rating}</span>
                    </div>
                    <div class="text-sm text-gray-600">Overall Rating</div>
                    <div class="text-lg font-semibold text-gray-900 mt-1">₹${vendor.monthly_revenue}/month</div>
                </div>
            </div>
            <div class="grid grid-cols-4 gap-4 mb-4">
                <div class="text-center"><div class="text-2xl font-bold text-green-600">${vendor.payment_score}</div><div class="text-xs text-gray-600">Payment</div></div>
                <div class="text-center"><div class="text-2xl font-bold text-blue-600">${vendor.reliability_score}</div><div class="text-xs text-gray-600">Reliability</div></div>
                <div class="text-center"><div class="text-2xl font-bold text-purple-600">${vendor.communication_score}</div><div class="text-xs text-gray-600">Communication</div></div>
                <div class="text-center"><div class="text-2xl font-bold text-orange-600">${vendor.order_volume_score}</div><div class="text-xs text-gray-600">Order Volume</div></div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600 mb-4">
                <div class="flex items-center"><i data-lucide="clock" class="h-4 w-4 mr-2"></i>Avg Payment: <span class="ml-1 font-medium">${vendor.avg_payment_buffertime} days</span></div>
                <div class="flex items-center"><i data-lucide="repeat" class="h-4 w-4 mr-2"></i>Orders: <span class="ml-1 font-medium">${vendor.orders_per_month}/month</span></div>
                <div class="flex items-center"><i data-lucide="phone" class="h-4 w-4 mr-2"></i>${vendor.phone_number}</div>
                <div class="flex items-center"><i data-lucide="percent" class="h-4 w-4 mr-2"></i>Credit Limit: <span class="ml-1 font-medium">₹${vendor.credit_limit}</span></div>
            </div>
        </div>`;
        vendorList.insertAdjacentHTML('beforeend', card);
    });

    lucide.createIcons(); // refresh icons
}

function renderStars(rating) {
    const fullStars = Math.floor(rating);
    const emptyStars = 5 - fullStars;
    return `${'★'.repeat(fullStars)}${'☆'.repeat(emptyStars)}`;
}

// Event listeners
document.querySelectorAll('#businessTypeFilter, #paymentRatingFilter, #riskLevelFilter, #locationFilter, #sortBy')
    .forEach(el => el.addEventListener('change', fetchAndRenderVendors));

// Trigger on load
document.addEventListener('DOMContentLoaded', fetchAndRenderVendors);

        // Initialize Lucide icons when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
        });
    </script>
</body>
</html>
